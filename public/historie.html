<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BUNCA HACCP ¬∑ Historie</title>
  <link rel="stylesheet" href="./css/style.css" />
</head>
<body>
<header class="header">
  <div class="nav">
    <a class="brand" href="index.html"><span>üõ°Ô∏è BUNCA HACCP</span></a>
    <div class="fill"></div>
    <select class="select" data-shop-select aria-label="Shop w√§hlen"></select>
    <a data-nav href="index.html">√úbersicht</a>
    <a data-nav href="historie.html">Historie</a>
    <a data-nav href="info.html">Anleitung</a>
    <a data-nav href="admin.html">Admin</a>
    <a href="#" class="btn" data-logout>Abmelden</a>
  </div>
</header>

<main class="container">
  <h2 class="h">Historie</h2>
  <div class="panel">
    <div style="display:flex;gap:8px;align-items:center">
      <input id="from" class="input" type="date" />
      <input id="to" class="input" type="date" />
      <button id="load" class="btn">Laden</button>
    </div>
    <table class="table" style="margin-top:12px">
      <thead><tr><th>Datum</th><th>Abweichungen</th><th>Notizen</th></tr></thead>
      <tbody id="rows"></tbody>
    </table>
  </div>
</main>

<footer class="footer">BUNCA HACCP ¬∑ Historie</footer>

<script src="./js/api.js"></script>
<script src="./js/ui.js"></script>
<script>
(async function(){
  if (!API.token()) { const e=prompt('E-Mail:'), p=prompt('Passwort:'); try{ await API.login(e,p);}catch{ alert('Login fehlgeschlagen');return; } }
  const rows = document.getElementById('rows');
  async function load(){
    rows.innerHTML = '<tr><td colspan="3">Laden‚Ä¶</td></tr>';
    const s = API.getShop().id;
    const data = await API.history(s, document.getElementById('from').value || undefined, document.getElementById('to').value || undefined);
    rows.innerHTML = '';
    data.forEach(d => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${d.date.split('-').reverse().join('.')}</td><td>${d.deviations}</td><td>${d.notes||''}</td>`;
      rows.appendChild(tr);
    });
    if (!data.length) rows.innerHTML = '<tr><td colspan="3">Keine Eintr√§ge.</td></tr>';
  }
  document.getElementById('load').onclick = load;
  load();
})();
</script>
</body>
</html>
