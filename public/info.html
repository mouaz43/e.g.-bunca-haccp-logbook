<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BUNCA HACCP · Anleitung</title>
  <style>
    :root{
      --bunca:#1f7a3a; --ink:#0f172a; --muted:#6b7280;
      --bg:#f5f7f5; --card:#fff; --border:#e7e9ec;
      --shadow:0 10px 30px rgba(16,24,40,.08); --r:16px;
    }
    html,body{height:100%} body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .hdr{position:sticky;top:0;z-index:40;background:var(--bunca);color:#fff;box-shadow:0 6px 18px rgba(16,24,40,.06)}
    .nav{max-width:1200px;margin:0 auto;padding:12px 18px;display:flex;gap:10px;align-items:center}
    .brand{display:flex;gap:10px;align-items:center;color:#fff;text-decoration:none;font-weight:800}
    .brand img{height:26px;width:auto} .spacer{flex:1}
    .shop{appearance:none;background:#fff;color:#0f172a;border:1px solid rgba(255,255,255,.45);border-radius:12px;padding:8px 38px 8px 12px;font-weight:700;background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%2310141f' stroke-width='2' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center}
    .links{display:flex;gap:6px;align-items:center}
    .links a{color:#e8ffef;text-decoration:none;font-weight:800;padding:8px 12px;border-radius:10px}
    .links a.active,.links a:hover{background:rgba(255,255,255,.18)}
    .logout{display:inline-flex;align-items:center;padding:8px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.35);color:#fff;text-decoration:none;font-weight:800}
    .logout:hover{background:rgba(255,255,255,.14)}
    .container{max-width:1200px;margin:28px auto;padding:0 18px}
    .h1{font-size:28px;margin:0 0 18px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .col-4{grid-column:span 4}.col-6{grid-column:span 6}.col-12{grid-column:span 12}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--r);box-shadow:var(--shadow);padding:16px}
    .card h3,.card h4{margin:0 0 10px}
    .thumb{width:100%;height:140px;object-fit:cover;border-radius:12px;margin:6px 0 8px}
    .section{margin-top:26px} .section h2{margin:0 0 10px}
    .sub{color:var(--muted);font-size:14px;margin:0 0 8px}
    @media (max-width: 900px){.col-4{grid-column:span 6}.col-6{grid-column:span 12}}
    @media (max-width: 640px){.col-4{grid-column:span 12}}
  </style>
</head>
<body>

<header class="hdr">
  <div class="nav">
    <a class="brand" href="index.html"><img src="assets/img/bunca-logo.svg" alt="" onerror="this.remove()"><span>BUNCA HACCP</span></a>
    <div class="spacer"></div>
    <select id="shopSelect" class="shop" aria-label="Shop auswählen">
      <option value="" disabled selected>– Shop wählen –</option>
    </select>
    <nav class="links" aria-label="Navigation">
      <a href="index.html"   data-nav>Übersicht</a>
      <a href="historie.html" data-nav>Historie</a>
      <a href="info.html"     data-nav>Anleitung</a>
      <a href="admin.html"    data-nav>Admin</a>
      <a href="cleaning.html" data-nav>Reinigungsplan</a>
    </nav>
    <a href="#" class="logout" data-logout>Abmelden</a>
  </div>
</header>

<main class="container">
  <h1 class="h1">Anleitung &amp; Soforthilfe</h1>

  <section class="section">
    <h2>Kurzanleitungen</h2>
    <div class="grid">
      <article class="card col-4">
        <h4>Händehygiene</h4>
        <img class="thumb" src="assets/img/hand-hygiene.jpg" alt="Hände waschen" onerror="this.style.display='none'">
        <p>Hände 20–30&nbsp;Sek. einseifen, Zwischenräume/Daumen/Nägel, gründlich abspülen, Einmalhandtuch.</p>
      </article>
      <article class="card col-4">
        <h4>Kühlkette</h4>
        <img class="thumb" src="assets/img/cold-chain.jpg" alt="Kühlkette" onerror="this.style.display='none'">
        <p>Eingangstemperatur messen, sofort einlagern, Türen nicht offen stehen lassen, FIFO beachten.</p>
      </article>
      <article class="card col-4">
        <h4>Reinigung</h4>
        <img class="thumb" src="assets/img/cleaning.jpg" alt="Reinigung" onerror="this.style.display='none'">
        <p>Von sauber nach schmutzig, Farbcodierung, Dosierung lt. Etikett, Kontaktzeit einhalten, dokumentieren.</p>
      </article>
    </div>
  </section>

  <section class="section">
    <h2>Bildliche Anleitungen</h2>
    <div class="grid">
      <article class="card col-6">
        <h4>Hände waschen (5 Schritte)</h4>
        <ol style="margin:8px 0 0 18px;line-height:1.6">
          <li>Nass machen</li><li>Einseifen</li><li>Reiben (20–30&nbsp;s)</li><li>Abspülen</li><li>Trocknen</li>
        </ol>
      </article>
      <article class="card col-6">
        <h4>Backstation Aufheizen</h4>
        <ol style="margin:8px 0 0 18px;line-height:1.6">
          <li>Ofen einschalten</li><li>Auf <strong>180&nbsp;°C</strong> einstellen</li><li>Vorlaufzeit beachten</li>
        </ol>
      </article>
    </div>
  </section>

  <div style="text-align:center;color:#64748b;margin:28px 0">BUNCA HACCP · v1 · Anleitung</div>
</main>

<script>
  // Highlight current nav entry
  (function(){
    var path = location.pathname.split('/').pop() || 'index.html';
    document.querySelectorAll('[data-nav]').forEach(function(a){
      if (a.getAttribute('href') === path) a.classList.add('active');
    });
  })();

  // Load shops from the same source as the rest of the app
  (async function syncShops(){
    var sel = document.getElementById('shopSelect');

    // try API first (same route other pages use)
    let names = [];
    try {
      const res = await fetch('/api/shops', {headers:{'accept':'application/json'}});
      if (res.ok) {
        const data = await res.json(); // expect [{id, name, active}] or ["BUNCA · City", ...]
        names = Array.isArray(data)
          ? data.map(s => typeof s === 'string' ? s : (s.name || s.title || s.label)).filter(Boolean)
          : [];
      }
    } catch (e) {
      // ignore, will fall back below
    }

    // fallback to what the app already stored, but DO NOT invent defaults
    if (names.length === 0) {
      try {
        const stored = JSON.parse(localStorage.getItem('bunca_shops') || '[]');
        if (Array.isArray(stored)) names = stored;
      } catch(e){}
    }

    // Populate (only real data; no hard-coded placeholders)
    sel.innerHTML = '<option value="" disabled'+(names.length ? '' : ' selected')+'>– Shop wählen –</option>' +
                    names.map(s => '<option value="'+s+'">'+s+'</option>').join('');

    // Restore current selection
    var current = localStorage.getItem('bunca_shop');
    if (current && names.includes(current)) sel.value = current;

    // Save selection so other pages pick it up
    sel.addEventListener('change', function(){
      localStorage.setItem('bunca_shop', sel.value);
      // some pages may react to storage events; this guarantees consistency on next load anyway
    });

    // keep in sync if user switches shop on another tab/page
    window.addEventListener('storage', function(ev){
      if (ev.key === 'bunca_shop' && names.includes(ev.newValue)) {
        sel.value = ev.newValue;
      }
      if (ev.key === 'bunca_shops') {
        try {
          const updated = JSON.parse(ev.newValue||'[]');
          if (Array.isArray(updated) && updated.length){
            names = updated;
            const cur = localStorage.getItem('bunca_shop');
            sel.innerHTML = '<option value="" disabled>– Shop wählen –</option>' +
                            names.map(s => '<option value="'+s+'">'+s+'</option>').join('');
            if (cur && names.includes(cur)) sel.value = cur;
          }
        } catch(e){}
      }
    });
  })();

  // Logout identical to other pages
  (function(){
    var btn = document.querySelector('[data-logout]');
    if (!btn) return;
    btn.addEventListener('click', function(e){
      e.preventDefault();
      localStorage.removeItem('bunca_role');
      window.location.href = 'index.html';
    });
  })();
</script>
</body>
</html>
