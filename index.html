<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BUNCA · HACCP Logbook</title>
  <link rel="icon" href="assets/img/bunca-logo.svg">
  <!-- Bootstrap 5 + Icons (CDN) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Custom styles -->
  <link href="assets/css/bunca.css" rel="stylesheet">
</head>
<body class="bg-body-tertiary">
  <!-- Top Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-bunca sticky-top shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center" href="index.html">
        <img src="assets/img/bunca-logo.svg" alt="BUNCA" width="28" height="28" class="me-2">
        <span class="fw-semibold">BUNCA HACCP</span>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#topnav" aria-controls="topnav" aria-expanded="false" aria-label="Menü umschalten">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="topnav">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link active" href="index.html"><i class="bi bi-speedometer2 me-1"></i> Übersicht</a></li>
          <li class="nav-item"><a class="nav-link" href="historie.html"><i class="bi bi-journal-text me-1"></i> Historie</a></li>
        </ul>

        <!-- Shop selector -->
        <div class="d-flex align-items-center gap-3">
          <div class="text-white-50 small d-none d-md-block" id="todayLabel"></div>
          <div class="input-group input-group-sm" style="width: 220px;">
            <label class="input-group-text bg-bunca-700 text-white" for="shopSelect"><i class="bi bi-shop"></i></label>
            <select id="shopSelect" class="form-select">
              <option value="hauptbahnhof">BUNCA · Hauptbahnhof</option>
              <option value="prenzlauer">BUNCA · Prenzlauer Berg</option>
              <option value="kreuzberg">BUNCA · Kreuzberg</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Page content -->
  <main class="container py-4">

    <!-- KPI Cards -->
    <div class="row g-3 mb-2" id="kpiRow">
      <div class="col-6 col-lg-3">
        <div class="card stat-card">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between">
              <div>
                <div class="text-secondary small">Checks (heute)</div>
                <div class="h4 mb-0" id="kpiChecks">0/0</div>
              </div>
              <i class="bi bi-clipboard2-check-fill fs-2 text-success"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="col-6 col-lg-3">
        <div class="card stat-card">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between">
              <div>
                <div class="text-secondary small">Abweichungen</div>
                <div class="h4 mb-0" id="kpiIssuesCount">0</div>
              </div>
              <i class="bi bi-exclamation-triangle-fill fs-2 text-warning"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="col-6 col-lg-3">
        <div class="card stat-card">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between">
              <div>
                <div class="text-secondary small">Letzte Speicherung</div>
                <div class="h6 mb-0" id="kpiSavedAt">–</div>
              </div>
              <i class="bi bi-cloud-check-fill fs-2 text-primary"></i>
            </div>
          </div>
        </div>
      </div>
      <div class="col-6 col-lg-3">
        <div class="card stat-card">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between">
              <div>
                <div class="text-secondary small">Shop</div>
                <div class="h6 mb-0" id="kpiShop">–</div>
              </div>
              <i class="bi bi-geo-alt-fill fs-2 text-info"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Grid -->
    <div class="row g-4">
      <!-- Left column: Checklist -->
      <div class="col-lg-8">
        <div class="card shadow-sm">
          <div class="card-header bg-white">
            <div class="d-flex align-items-center justify-content-between">
              <h5 class="mb-0"><i class="bi bi-check2-square me-2 text-bunca"></i>HACCP Tages-Checkliste <span class="text-secondary" id="dateBadge"></span></h5>
              <div class="d-flex gap-2">
                <button class="btn btn-sm btn-outline-secondary" id="btnReset"><i class="bi bi-arrow-counterclockwise me-1"></i> Zurücksetzen</button>
                <button class="btn btn-sm btn-primary" id="btnSave"><i class="bi bi-save2 me-1"></i> Speichern</button>
              </div>
            </div>
            <div class="small text-secondary mt-1">Zielbereiche sind Hinweise; interne Vorgaben gelten vorrangig.</div>
          </div>

          <div class="card-body">
            <!-- Temperaturen -->
            <h6 class="text-uppercase text-secondary small mb-2">Temperaturen</h6>
            <div class="row g-3 align-items-end">
              <div class="col-md-6">
                <label class="form-label">Kühlschrank 1 <span class="text-secondary small">(0–7 °C)</span></label>
                <div class="input-group">
                  <input type="number" step="0.1" class="form-control" id="temp_k1" placeholder="z. B. 4.2">
                  <span class="input-group-text">°C</span>
                </div>
                <div class="form-text" id="hint_k1"></div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Kühlschrank 2 <span class="text-secondary small">(0–7 °C)</span></label>
                <div class="input-group">
                  <input type="number" step="0.1" class="form-control" id="temp_k2" placeholder="z. B. 5.0">
                  <span class="input-group-text">°C</span>
                </div>
                <div class="form-text" id="hint_k2"></div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Tiefkühler <span class="text-secondary small">(≤ −18 °C)</span></label>
                <div class="input-group">
                  <input type="number" step="0.1" class="form-control" id="temp_tf" placeholder="-18">
                  <span class="input-group-text">°C</span>
                </div>
                <div class="form-text" id="hint_tf"></div>
              </div>
              <div class="col-md-6">
                <label class="form-label">Ofen/Backstation Betriebstemperatur <span class="text-secondary small">(≥ 180 °C)</span></label>
                <div class="input-group">
                  <input type="number" step="1" class="form-control" id="temp_ofen" placeholder="180">
                  <span class="input-group-text">°C</span>
                </div>
                <div class="form-text" id="hint_ofen"></div>
              </div>
            </div>

            <hr class="my-4">

            <!-- Funktionschecks -->
            <h6 class="text-uppercase text-secondary small mb-2">Funktionschecks</h6>
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="check_spuel" />
                  <label class="form-check-label" for="check_spuel">Spülmaschine Spültemperatur ≥ 82 °C</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="check_wasser" />
                  <label class="form-check-label" for="check_wasser">Handwaschbecken Warmwasser vorhanden</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="check_reinigung" />
                  <label class="form-check-label" for="check_reinigung">Reinigungsplan (Schichtende) erledigt</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="check_abtau" />
                  <label class="form-check-label" for="check_abtau">Abtau-Status geprüft</label>
                </div>
              </div>
            </div>

            <hr class="my-4">

            <!-- Notizen & schnell Issue -->
            <div class="mb-3">
              <label for="notes" class="form-label">Anmerkungen</label>
              <textarea id="notes" class="form-control" rows="3" placeholder="z. B. Milchlieferung verspätet, Kühlschrank 2 lärmt …"></textarea>
            </div>

            <div class="d-flex gap-2">
              <button class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#issueModal"><i class="bi bi-bug-fill me-1"></i> Problem melden</button>
              <button class="btn btn-primary" id="btnSaveBottom"><i class="bi bi-save2 me-1"></i> Speichern</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Right column: Open issues + Today list -->
      <div class="col-lg-4">
        <div class="card shadow-sm mb-4">
          <div class="card-header bg-white">
            <h6 class="mb-0"><i class="bi bi-exclamation-octagon-fill text-warning me-2"></i>Offene Issues (heute)</h6>
          </div>
          <div class="list-group list-group-flush" id="issuesList">
            <div class="list-group-item text-secondary small">Noch keine Einträge.</div>
          </div>
          <div class="card-footer bg-white d-grid gap-2">
            <a class="btn btn-outline-secondary btn-sm" href="historie.html"><i class="bi bi-clock-history me-1"></i> Historie & Export</a>
          </div>
        </div>

        <div class="card shadow-sm">
          <div class="card-header bg-white">
            <h6 class="mb-0"><i class="bi bi-list-check text-success me-2"></i>Heutige Punkte</h6>
          </div>
          <ul class="list-group list-group-flush" id="todayChecklistPreview">
            <!-- filled by JS -->
          </ul>
        </div>
      </div>
    </div>
  </main>

  <!-- Issue Modal -->
  <div class="modal fade" id="issueModal" tabindex="-1" aria-labelledby="issueModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h6 class="modal-title" id="issueModalLabel">Problem melden</h6>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Schließen"></button>
        </div>
        <div class="modal-body">
          <label class="form-label">Beschreibung</label>
          <textarea id="issueText" class="form-control" rows="4" placeholder="Beschreibe das Problem …"></textarea>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
          <button class="btn btn-warning" id="btnAddIssue"><i class="bi bi-plus-circle me-1"></i> Hinzufügen</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS + App -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/checklist.js"></script>
</body>
</html>
